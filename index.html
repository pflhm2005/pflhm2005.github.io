<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>书生小龙</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="书生小龙">
<meta property="og:url" content="http://c.hiphotos.baidu.com/zhidao/pic/item/b03533fa828ba61e9a43845d4734970a304e5916.jpg/index.html">
<meta property="og:site_name" content="书生小龙">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="书生小龙">
  
    <link rel="alternate" href="/atom.xml" title="书生小龙" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">书生小龙</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://c.hiphotos.baidu.com/zhidao/pic/item/b03533fa828ba61e9a43845d4734970a304e5916.jpg"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-upload2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/23/upload2/" class="article-date">
  <time datetime="2017-10-23T08:42:38.000Z" itemprop="datePublished">2017-10-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/23/upload2/">element-ui源码修改笔记2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>######产品又加了一个需求，要求删除图片时候弹一个提示框，如果确定就直接发请求从服务器删除图片</p>
<p>​    一开始想的比较简单，直接在on-remove的钩子函数上做弹框提示，如果取消就撤销，代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">el-upload</span> <span class="attr">:on-remove</span>=<span class="string">'remove'</span>&gt;</span><span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">remove:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.$confirm(<span class="string">'此操作将永久删除图片, 是否继续?'</span>, <span class="string">'提示'</span>, &#123;</div><div class="line">        <span class="comment">// ...若干处理代码</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    并不行，在我点下删除按钮的一瞬间，图片就消失了，接着才弹框。</p>
<p>​    跑去看源码，才发现里面的逻辑是这样的：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- upload-list.vue --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">"!disabled"</span> <span class="attr">class</span>=<span class="string">"el-upload-list__item-delete"</span> @<span class="attr">click</span>=<span class="string">"$emit('remove', file)"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- index.vue --&gt;</span></div><div class="line">&lt;UploadList ... on-remove=&#123;this.handleRemove&#125;&lt;/UploadList&gt;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">handleRemove(file, raw) &#123;</div><div class="line">  <span class="keyword">if</span> (raw) &#123;</div><div class="line">    file = <span class="keyword">this</span>.getFile(raw);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">this</span>.abort(file);</div><div class="line">  <span class="keyword">let</span> fileList = <span class="keyword">this</span>.uploadFiles;</div><div class="line">  <span class="comment">// 先从fileList删除图片</span></div><div class="line">  fileList.splice(fileList.indexOf(file), <span class="number">1</span>);</div><div class="line">  <span class="comment">// 再触发remove事件</span></div><div class="line">  <span class="keyword">this</span>.onRemove(file, fileList);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    这样子就明白了，想在图片删除(消失)前出框只能撸源码了。</p>
<p>​    由于element-ui有自带的弹框组件，所以如果能在源码直接嵌入组件那就最好了，于是我在handleRemove中打印了一下<code>this</code>，显示为<code>VueComponent</code>，与我写的vue文件的this一样，所以方法可以直接用，那就太方便了。</p>
<p>​    修改后，源码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// index.vue</span></div><div class="line"><span class="comment">// 首先添加一个变量来控制这个功能</span></div><div class="line">jimmyRemoveTip: &#123;</div><div class="line">  type: <span class="built_in">Boolean</span>,</div><div class="line">  <span class="keyword">default</span>: <span class="literal">false</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 根据变量控制流程</span></div><div class="line">handleRemove(file, raw) &#123;</div><div class="line">  <span class="comment">// 添加的确认环节</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.jimmyRemoveTip) &#123;</div><div class="line">    <span class="keyword">this</span>.$confirm(<span class="string">'此操作将永久删除图片, 是否继续?'</span>, <span class="string">'提示'</span>, &#123;</div><div class="line">      confirmButtonText: <span class="string">'确定'</span>,</div><div class="line">      cancelButtonText: <span class="string">'取消'</span>,</div><div class="line">      type: <span class="string">'warning'</span></div><div class="line">    &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      <span class="comment">// ...删除图片</span></div><div class="line">    &#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">this</span>.$message(&#123;</div><div class="line">        type: <span class="string">'info'</span>,</div><div class="line">        message: <span class="string">'已取消删除'</span></div><div class="line">      &#125;);          </div><div class="line">    &#125;);</div><div class="line">  &#125;<span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">// 正常流程</span></div><div class="line">  &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    (语法检查真是严格，else前后，大括号前必须有空格)</p>
<p>​    这样，只要在组件传一个<code>:jimmyRemoveTip=&#39;true&#39;</code>，点击删除按钮就会弹一个提示框，确定才会走删除流程，否则框消失。</p>
<p><img src="/img/del.png"></p>
<p>​    成功，骚的一批！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://c.hiphotos.baidu.com/zhidao/pic/item/b03533fa828ba61e9a43845d4734970a304e5916.jpg/2017/10/23/upload2/" data-id="cj959bq4x0002c8nj53gn58fd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-upload" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/23/upload/" class="article-date">
  <time datetime="2017-10-23T01:12:18.000Z" itemprop="datePublished">2017-10-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/23/upload/">element-ui源码修改笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>  前几天时间给element-ui提了一个问题，结果没有鸟我，没办法，只能修改源码来满足需求了</p>
</blockquote>
<p>######本文讨论的组件属性仅限于<code>list-type=&#39;picture-card&#39;</code></p>
<hr>
<p>​    现在的问题是这样的：</p>
<p>​    element-ui中有一个upload组件，可以上传图片或文件。该组件有很丰富的钩子函数与配置，但是没有一个限制上传图片数量(即使是按钮禁用)的方法，于是我就自己封装了一下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">el-upload</span> <span class="attr">:disabled</span>=<span class="string">'is_max'</span> @<span class="attr">s</span>=<span class="string">'...'</span> @<span class="attr">r</span>=<span class="string">'....'</span> <span class="attr">...</span>其余配置&gt;</span><span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> = &#123;</div><div class="line">  props:[<span class="string">'num'</span>], <span class="comment">// 限制上传数量</span></div><div class="line">  methods:&#123;</div><div class="line">    on-success:<span class="function"><span class="keyword">function</span>(<span class="params">r,f,fl</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.is_max = <span class="literal">true</span>;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.num &amp;&amp; <span class="keyword">this</span>.num === fl.length)&#123;</div><div class="line">    <span class="keyword">this</span>.is_max = <span class="literal">false</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">this</span>.$emit(<span class="string">'s'</span>,f,fl);</div><div class="line">&#125;,</div><div class="line">  on-remove:<span class="function"><span class="keyword">function</span>(<span class="params">f,fl</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.is_max = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">this</span>.$emit(<span class="string">'r'</span>,f);</div><div class="line">  &#125;,</div><div class="line">  on-progress:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">this</span>.is_max = <span class="literal">true</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    封装添加了一个num参数，限制上传数量，并在上传过程中禁用上传按钮。</p>
<p>​    最初的目的是达到上传数量限制，就禁止上传，但是可以删除图片，删除后解除限制。</p>
<p>​    这个需求在1.3.7版本可以实现，但是在后面的某一次(可见我上一篇文章的结尾)commit中被修改了，删除与上传同时受disabled影响，如果设置disabled=’true’，那么这个组件变成了一个纯展示作用，无法删除，无法添加。</p>
<p>​    后来决定暂时用1.3.7版本打包，先出功能。</p>
<hr>
<p>​    原以为事情可以缓一缓，没想到产品对那个上传按钮十分不满，认为如果达到了上限，这个按钮会产生困惑，应该消失。禁用不行，里面弄个叉也不行，必须要消失！</p>
<p>​    好吧，只能来一发硬的，改源码。</p>
<p>​    上传按钮控制的标签如下所示，type为picture,text,picture-card之一。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'el-upload el-upload--(type)'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>​    当时有两个想法：</p>
<p>1、修改disabled的默认行为，让上传按钮消失，删除按钮不作用</p>
<p>2、引入新的变量，单独控制上传按钮</p>
<p>​    由于不知道源码的内部行为，所以先想着。</p>
<p>​    一开始想法十分简单，找到了目录node_modules\element-ui\packages\upload\src下的upload.vue文件，为了看效果，直接添加了一行代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// line-163</span></div><div class="line"><span class="keyword">const</span> data = &#123;</div><div class="line">  class: &#123;</div><div class="line">    <span class="string">'el-upload'</span>: <span class="literal">true</span>,</div><div class="line">    <span class="string">'abc'</span>: <span class="literal">true</span>, <span class="comment">// 这里是我自己加的</span></div><div class="line">  &#125;,</div><div class="line">  on: &#123;</div><div class="line">    click: handleClick</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>​    保存-打包-打开网页-F12，发现并没有abc这个类被加上去，查看打包后的JS文件，依然只有一个el-upload类。</p>
<p>​    这就十分尴尬了，于是换了个地方，找到了node_modules\element-ui\lib下的upload.js文件，添加了两行代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// line-934</span></div><div class="line"><span class="keyword">var</span> data = &#123;</div><div class="line">  class: &#123;</div><div class="line">    <span class="string">'el-upload'</span>: <span class="literal">true</span>,</div><div class="line">    <span class="string">'abc'</span>: <span class="literal">true</span> <span class="comment">//同上</span></div><div class="line">  &#125;,</div><div class="line">  on: &#123;</div><div class="line">    click: handleClick</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// line-1312</span></div><div class="line"><span class="keyword">var</span> oClass = &#123; <span class="string">'el-upload'</span>: <span class="literal">true</span>, <span class="string">'abc'</span>:<span class="literal">true</span>&#125;;</div><div class="line">oClass[<span class="string">'el-upload--'</span> + listType] = <span class="literal">true</span>;</div></pre></td></tr></table></figure>
<p>​    这里直接修改了打包后的render函数，我想着这次应该稳了，结果打包后一看，还是不行。</p>
<p>​    这就十分尴尬了，只能上网搜搜。一开始找到教程，教你修改哪个文件，然后实现功能，然而跟我之前的步骤一样，不可信。继续搜索，终于找到了一位小哥：<a href="https://segmentfault.com/a/1190000010932321" target="_blank" rel="external">https://segmentfault.com/a/1190000010932321</a></p>
<p>​    懒得看网页的可以找一个安静的文件夹，依次运行以下指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/ElemeFE/element.git</div><div class="line">cd element</div><div class="line">npm install</div></pre></td></tr></table></figure>
<p>​    此时，element的元身会被下载下来。接下来修改package文件夹中的源码，运行npm run dist指令，该指令会在当前目录生成一个lib文件夹，用这个文件夹替换node_modules中的lib文件夹，然后打包就可以了！</p>
<p>​    事不宜迟，试试！</p>
<p>​    找到了element\packages\upload\src下的upload.vue，再次进行修改：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class: &#123;</div><div class="line">  <span class="string">'el-upload'</span>: <span class="literal">true</span>,</div><div class="line">    <span class="string">'abc'</span>:<span class="literal">true</span>,</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>​    又是熟悉的操作，然而报了2个error，一脸懵逼的看错误信息：</p>
<p>1、Missing space before value for key ‘abc’ </p>
<p>2、Unexpected trailing comma</p>
<p>​    凭着我过硬的英文功底修正了错误：</p>
<p>1、冒号后面要加空格</p>
<p>2、最后一个属性的逗号要省略</p>
<p>​    修改后再次运行，眼前闪过一片花花绿绿，成了。</p>
<p>​    覆盖了lib文件夹后再次尝试，可以惊喜的看到：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'el-upload abc el-upload--picture-card'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>​    感觉人生都阳光起来了,接下来是实现目标的时候了。</p>
<hr>
<p>​    简略的看了下upload组件内部，有包含5个组件index、iframe-upload、upload-dragger、upload-list、upload。</p>
<p>​    其中iframe-table是造一个表单，然后表单提交图片信息，略过。</p>
<p>​    upload-dragger是拖拽功能，略过。</p>
<p>​    upload-list实现已图片上传预览，略过。</p>
<p>​    需要关注的只有整合所有组件的index与上传按钮相关的upload组件了。</p>
<p>​    index.vue的整个大概是这样：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">upload-list</span>&gt;</span><span class="tag">&lt;/<span class="name">upload-list</span>&gt;</span> <span class="comment">&lt;!-- 用于展示图片 仅当picture-card类型时在前面 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">uploadComponent</span>&gt;</span> <span class="comment">&lt;!-- 上传 内部的DOM会被当成上传按钮 通过FormDataAPI决定调用表单或者ajax --&gt;</span></div><div class="line">  	<span class="tag">&lt;<span class="name">upload</span>&gt;</span><span class="tag">&lt;/<span class="name">upload</span>&gt;</span> <span class="comment">&lt;!-- drag属性决定是否支持拖拽 --&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">uploadComponent</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>​    仔细看了一遍内部实现，再回头看一眼之前的2个想法，决定用第二个，修改默认有点麻烦。</p>
<p>​    方式比较简单粗暴，在所有定义diabled的地方加上了一条新语句，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// line-94</span></div><div class="line">&#123;</div><div class="line">  disabled: <span class="built_in">Boolean</span></div><div class="line">  Jimmy_input_btn_disabled: <span class="built_in">Boolean</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    这样就自定义了一个新的数据，第二步，通过这个来阻止上传按钮生成。</p>
<p>​    找来找去，只有一个地方可以控制：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// line-254</span></div><div class="line"><span class="comment">// 这里是上传按钮的渲染点</span></div><div class="line"><span class="keyword">const</span> uploadComponent = </div><div class="line">      <span class="keyword">this</span>.Jimmy_input_btn_disabled ? <span class="string">''</span> : <span class="comment">// 我加的</span></div><div class="line">      (<span class="keyword">typeof</span> FormData !== <span class="string">'undefined'</span> || <span class="keyword">this</span>.$isServer)</div><div class="line">? <span class="xml"><span class="tag">&lt;<span class="name">upload</span> &#123;<span class="attr">...uploadData</span>&#125;&gt;</span>&#123;trigger&#125;<span class="tag">&lt;/<span class="name">upload</span>&gt;</span></span></div><div class="line">: <span class="xml"><span class="tag">&lt;<span class="name">iframeUpload</span> &#123;<span class="attr">...uploadData</span>&#125;&gt;</span>&#123;trigger&#125;<span class="tag">&lt;/<span class="name">iframeUpload</span>&gt;</span></span>;</div></pre></td></tr></table></figure>
<p>​    加上后，打包测试：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">el-upload</span> <span class="attr">:Jimmy_input_btn_disabled</span>=<span class="string">'is_max'</span> <span class="attr">...</span>其余配置&gt;</span><span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></div></pre></td></tr></table></figure>
<p>​    在图片达到上限后，上传按钮惊喜的消失了，舒服！</p>
<p>​    然而，在下一秒，我删除图片的时候，就报了一个错，abort无法执行。</p>
<p>​    顺着报错信息，找到了这里：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 删除时候会调用的函数</span></div><div class="line">handleRemove(file, raw) &#123;</div><div class="line">  <span class="keyword">if</span> (raw) &#123;</div><div class="line">    file = <span class="keyword">this</span>.getFile(raw);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">this</span>.abort(file);</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;,</div><div class="line">  <span class="comment">//...</span></div><div class="line">abort(file) &#123;</div><div class="line">  <span class="keyword">this</span>.$refs[<span class="string">'upload-inner'</span>].abort(file);</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>​    这个upload-inner呢，在index.vue也有定义：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> uploadData = &#123;</div><div class="line">  props: &#123;</div><div class="line">    <span class="comment">// ...一堆参数</span></div><div class="line">  &#125;,</div><div class="line">  ref: <span class="string">'upload-inner'</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>​    再看看上面uploadComponent的定义，我瞬间明白了，这个ref被作为参数传给了上传按钮，删除图片需要执行绑定在该按钮上面的abort函数。问题是，这个按钮被我弄没了，而且由于vue的’析构’，DOM上的事件也没了。</p>
<p>​    结果就是，不可行，粗暴是不对的，两个方案同时否决。</p>
<hr>
<p>​    想了好久，既然不能让DOM消失，那么弄成display:none不就OK了么。</p>
<p>​    两个方案：</p>
<p>1、根据某个条件动态渲染一个自定义的class，该class定义为diaplay:none</p>
<p>2、根据某个条件动态渲染行内样式display:none</p>
<p>​    由于render函数不太记得用法，所以第二个看起来实现有点难度，决定用第一个。当然，这个条件不能是默认的diabled，所以，我的Jimmy_input_btn_disabled又可以出场了。</p>
<p>​    修改的时候遇到了瓶颈，里面的代码居然是JSX，我修改了upload.vue：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class: &#123;</div><div class="line">  <span class="string">'el-upload'</span>: <span class="literal">true</span>,</div><div class="line">  <span class="string">'abc'</span> : !!<span class="keyword">this</span>.Jimmy_input_btn_disabled</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>​    很明显，虽然数据传进来了，但是并没有做到动态渲染，这里只是初始化，所以abc没有出现过，并且在变动的时候，根元素出现了这样的情况：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">Jimmy_input_btn_disabled</span> = <span class="string">'true'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>​    当时真是笑尿我了。</p>
<p>​    一度陷入了僵局，JSX不知道怎么写。如果是vue中的render函数，我还可以写个demo然后模仿。</p>
<p>​    最后我甚至跑去看react的教程，但是人家变动数据用的是setState……</p>
<p>​    </p>
<hr>
<p>​    在不断的尝试中的，我是找到了办法，简单的吐血。</p>
<p>​    其实早就发现了，只是陷入了一个误区。</p>
<p>​    首先这个Jimmy_input_btn_disabled需要更改为String类型，作为一个动态类传入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">disabled: <span class="built_in">Boolean</span>,</div><div class="line">Jimmy_inputbtn_disabled: <span class="built_in">String</span></div></pre></td></tr></table></figure>
<p>​    第二步，在JSX中直接写class：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> &#123;<span class="attr">...data</span>&#125; <span class="attr">class</span>=<span class="string">&#123;Jimmy_input_btn_disabled&#125;</span>&gt;</span></div><div class="line">  ...</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>​    源码修改完成，打包。</p>
<p>​    html中如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:Jimmy_input_btn_disabled</span> = <span class="string">'xxx'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>​    JS文件如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> Vue(&#123;</div><div class="line">  data:&#123;</div><div class="line">    xxx:<span class="string">''</span></div><div class="line">  &#125;,</div><div class="line">  methods:&#123;</div><div class="line">    s:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">// 达到上限</span></div><div class="line">      <span class="keyword">this</span>.xxx = <span class="string">'xxx'</span>;</div><div class="line">    &#125;,</div><div class="line">    r:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">// 解除</span></div><div class="line">      <span class="keyword">this</span>.xxx = <span class="string">''</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>​    CSS很简单，直接设置<code>xxx{display:none}</code>就行了。</p>
<p><img src="/img/rev.png"></p>
<p><img src="/img/suc.png"></p>
<p>​    最后测试结果十分成功，双击666！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://c.hiphotos.baidu.com/zhidao/pic/item/b03533fa828ba61e9a43845d4734970a304e5916.jpg/2017/10/23/upload/" data-id="cj959bq500004c8njle5ahe6r" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-bug-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/18/bug-note/" class="article-date">
  <time datetime="2017-10-18T03:03:24.000Z" itemprop="datePublished">2017-10-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/18/bug-note/">element-ui组件问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<blockquote>
<p>最近写项目在用element-ui，二次封装了一些组件，但是发现了一些问题</p>
</blockquote>
<p>​    这个问题的出现很奇怪，项目里封装的时候，不会出现问题，结构如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"upload-content"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"upload-title"</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">el-upload</span></span></div><div class="line"><span class="tag">        <span class="attr">:action</span>=<span class="string">'action'</span></span></div><div class="line"><span class="tag">        <span class="attr">list-type</span>=<span class="string">"picture-card"</span></span></div><div class="line"><span class="tag">        <span class="attr">:on-remove</span>=<span class="string">"remove"</span></span></div><div class="line"><span class="tag">        <span class="attr">:on-success</span>=<span class="string">'success'</span></span></div><div class="line"><span class="tag">        <span class="attr">:on-progress</span>=<span class="string">'progress'</span></span></div><div class="line"><span class="tag">        <span class="attr">:disabled</span>=<span class="string">'isMax'</span></span></div><div class="line"><span class="tag">        <span class="attr">:file-list</span>=<span class="string">'fileList'</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-plus"</span> <span class="attr">v-show</span>=<span class="string">'!isMax'</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      isMax:<span class="literal">false</span>,</div><div class="line">      action:<span class="string">'...'</span>,</div><div class="line">      fileList:[]</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  props: [</div><div class="line">    <span class="string">'title'</span>,</div><div class="line">    <span class="string">'list'</span>,</div><div class="line">    <span class="string">'index'</span>,</div><div class="line">    <span class="string">'num'</span></div><div class="line">  ],</div><div class="line">  methods: &#123;</div><div class="line">    remove:<span class="function"><span class="keyword">function</span>(<span class="params">file, fileList</span>) </span>&#123;</div><div class="line">      <span class="keyword">this</span>.isMax = <span class="literal">false</span>;</div><div class="line">      <span class="keyword">this</span>.$emit(<span class="string">'upload_rev'</span>,file);</div><div class="line">    &#125;,</div><div class="line">    success:<span class="function"><span class="keyword">function</span>(<span class="params">response, file, fileList</span>)</span>&#123;</div><div class="line">      <span class="keyword">this</span>.isMax = <span class="literal">false</span>;</div><div class="line">      <span class="keyword">if</span>(<span class="keyword">this</span>.num &amp;&amp; fileList.length === <span class="keyword">this</span>.num)&#123;</div><div class="line">        <span class="keyword">this</span>.isMax = <span class="literal">true</span>;</div><div class="line">      &#125;</div><div class="line">      file.url = response.data.file.url;</div><div class="line">      <span class="keyword">if</span>(<span class="keyword">this</span>.index)&#123;</div><div class="line">        file.img_type = <span class="keyword">this</span>.index;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">this</span>.$emit(<span class="string">'upload_suc'</span>,file,fileList,<span class="keyword">this</span>.index);</div><div class="line">    &#125;,</div><div class="line">    progress:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">this</span>.isMax = <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  created:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.list)&#123;</div><div class="line">      <span class="keyword">this</span>.fileList = <span class="keyword">this</span>.list;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    这里的封装我主要是有这几个目的：</p>
<p>1、上传过程中上传按钮禁用，保证一次只会上传一张</p>
<p>2、可以通过传入num来限制上传图片的上限，达到上传禁止上传，删除一张后解除限制</p>
<p>3、index用来做标记，因为有可能一个页面有3个类型的图集要上传图片，这样可以通过传1、2、3来区分，3个图集的上传可以共用一个函数</p>
<p>​    在项目中，这个功能是实现了，但是单独抽出来再测试的时候，却出现了问题：上传图片达到上限后，图片无法删除。也就是当el-upload上的disabled属性生效后，删除的按钮就渲染不出来了。</p>
<p>​    </p>
<p>​        通过DOM可以更直观的看到这个现象，正常情况下DOM结构如图：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"el-upload-list el-upload-list--picture-card"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 上传图片展示区域 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"el-upload-list__item is-success"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"..."</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"el-upload-list__item-thumbnail"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"el-upload-list__item-name"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-document"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">      <span class="comment">&lt;!-- 右上角的勾 --&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"el-upload-list__item-status-label"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-upload-success el-icon-check"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-close"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"el-upload-list__item-actions"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 正常情况删除按钮 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"el-upload-list__item-delete"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-delete2"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 异常情况 --&gt;</span></div><div class="line">        <span class="comment">&lt;!----&gt;</span></div><div class="line">        <span class="comment">&lt;!----&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- 上传按钮 --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"el-upload el-upload--picture-card"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-plus"</span> <span class="attr">style</span>=<span class="string">"display: none;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">class</span>=<span class="string">"el-upload__input"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>​    大体上包含两个部分，一个是已上传图片区域，一个是上传按钮区域。</p>
<p>​    问题出在那个删除按钮，在disabled属性为true时，里面的DOM全部没了。</p>
<p>​    由于在项目中未出现这个问题，一开始没有发现，后来单独抽出来想改进的时候，发现了这个问题。由于怎么想也不明白，所以直接去看了源码，node_modules中的element-ui中的目录为element-ui/lib/upload.js，在源码中的643行-703行有上传图片展示区域的render函数，简化后代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// &lt;li class="el-upload-list__item is-success"&gt;</span></div><div class="line">_c(<span class="string">'li'</span>, &#123;</div><div class="line">  key: index,</div><div class="line">  class: ['el-upload-list__item', 'is-' + file.status]</div><div class="line">&#125;,</div><div class="line">   <span class="comment">// 下面是li的子节点</span></div><div class="line">   [(file.status !== <span class="string">'uploading'</span> &amp;&amp; [<span class="string">'picture-card'</span>, <span class="string">'picture'</span>].indexOf(_vm.listType) &gt; <span class="number">-1</span>) ?</div><div class="line">    <span class="comment">// img标签</span></div><div class="line">    _c(<span class="string">'img'</span>, &#123;</div><div class="line">      staticClass: <span class="string">"el-upload-list__item-thumbnail"</span>,</div><div class="line">      attrs: &#123;</div><div class="line">        <span class="string">"src"</span>: file.url,</div><div class="line">        <span class="string">"alt"</span>: <span class="string">""</span></div><div class="line">      &#125;</div><div class="line">    &#125;) : _vm._e(),</div><div class="line">    <span class="comment">// &lt;a class="el-upload-list__item-name"&gt;</span></div><div class="line">    _c(<span class="string">'a'</span>, &#123;</div><div class="line">      staticClass: <span class="string">"el-upload-list__item-name"</span>,</div><div class="line">      on: &#123;</div><div class="line">        <span class="string">"click"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">$event</span>) </span>&#123;</div><div class="line">          _vm.handleClick(file)</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">       <span class="comment">// 子节点&lt;i class="el-icon-document"&gt;</span></div><div class="line">       [_c(<span class="string">'i'</span>, &#123;</div><div class="line">         staticClass: <span class="string">"el-icon-document"</span></div><div class="line">       &#125;), _vm._v(_vm._s(file.name) + <span class="string">"\n    "</span>)]),</div><div class="line">    <span class="comment">/// &lt;label class="el-upload-list__item-status-label"&gt;</span></div><div class="line">    _c(<span class="string">'label'</span>, &#123;</div><div class="line">      staticClass: <span class="string">"el-upload-list__item-status-label"</span></div><div class="line">    &#125;,</div><div class="line">       <span class="comment">/* 子节点&lt;i class="el-icon-upload-success el-icon-check"&gt; */</span></div><div class="line">       [_c(<span class="string">'i'</span>, &#123;</div><div class="line">         class: &#123;</div><div class="line">           <span class="string">'el-icon-upload-success'</span>: <span class="literal">true</span>,</div><div class="line">           <span class="string">'el-icon-circle-check'</span>: _vm.listType === <span class="string">'text'</span>,</div><div class="line">           <span class="string">'el-icon-check'</span>: [<span class="string">'picture-card'</span>, <span class="string">'picture'</span>].indexOf(_vm.listType) &gt; <span class="number">-1</span></div><div class="line">         &#125;</div><div class="line">       &#125;)]),</div><div class="line">    <span class="comment">// 这里出现disabled</span></div><div class="line">    (!_vm.disabled) ?</div><div class="line">    <span class="comment">/* &lt;i class="el-icon-close"&gt;&lt;/i&gt; */</span></div><div class="line">    _c(<span class="string">'i'</span>, &#123;</div><div class="line">      staticClass: <span class="string">"el-icon-close"</span>,</div><div class="line">      on: &#123;</div><div class="line">        <span class="string">"click"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">$event</span>) </span>&#123;</div><div class="line">          _vm.$emit(<span class="string">'remove'</span>, file)</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;) : _vm._e(),</div><div class="line">    <span class="comment">// 上传中则渲染下面的节点</span></div><div class="line">    (file.status === <span class="string">'uploading'</span>) ?</div><div class="line">    _c(<span class="string">'el-progress'</span>, &#123;</div><div class="line">      attrs: &#123;</div><div class="line">        <span class="string">"type"</span>: _vm.listType === <span class="string">'picture-card'</span> ? <span class="string">'circle'</span> : <span class="string">'line'</span>,</div><div class="line">        <span class="string">"stroke-width"</span>: _vm.listType === <span class="string">'picture-card'</span> ? <span class="number">6</span> : <span class="number">2</span>,</div><div class="line">        <span class="string">"percentage"</span>: _vm.parsePercentage(file.percentage)</div><div class="line">      &#125;</div><div class="line">    &#125;) : _vm._e(),</div><div class="line">    <span class="comment">// 根据listType渲染</span></div><div class="line">    (_vm.listType === <span class="string">'picture-card'</span>) ?</div><div class="line">    <span class="comment">// &lt;span class="el-upload-list__item-actions"&gt;</span></div><div class="line">    _c(<span class="string">'span'</span>, &#123;</div><div class="line">      staticClass: <span class="string">"el-upload-list__item-actions"</span></div><div class="line">    &#125;,</div><div class="line">       <span class="comment">// 根据是否存在on-preview钩子渲染</span></div><div class="line">       [(_vm.handlePreview &amp;&amp; _vm.listType === <span class="string">'picture-card'</span>) ?</div><div class="line">        <span class="comment">// </span></div><div class="line">        _c(<span class="string">'span'</span>, &#123;</div><div class="line">          staticClass: <span class="string">"el-upload-list__item-preview"</span>,</div><div class="line">          on: &#123;</div><div class="line">            <span class="string">"click"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">$event</span>) </span>&#123;</div><div class="line">              _vm.handlePreview(file)</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;, [_c(<span class="string">'i'</span>, &#123;</div><div class="line">          staticClass: <span class="string">"el-icon-view"</span></div><div class="line">        &#125;)]) : _vm._e(),</div><div class="line">        <span class="comment">// 问题出在这里！</span></div><div class="line">        (!_vm.disabled) ?</div><div class="line">        <span class="comment">// &lt;span class="el-upload-list__item-delete"&gt; </span></div><div class="line">        _c(<span class="string">'span'</span>, &#123;</div><div class="line">          staticClass: <span class="string">"el-upload-list__item-delete"</span>,</div><div class="line">          on: &#123;</div><div class="line">            <span class="string">"click"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">$event</span>) </span>&#123;</div><div class="line">              _vm.$emit(<span class="string">'remove'</span>, file)</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;, [_c(<span class="string">'i'</span>, &#123;</div><div class="line">          staticClass: <span class="string">"el-icon-delete2"</span></div><div class="line">        &#125;)]) : _vm._e() <span class="comment">/* 渲染注释 */</span></div><div class="line">       ]) : _vm._e()</div><div class="line">   ], <span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>​    问题原因找到了，确实在源码中，根据disabled属性会影响到删除按钮的生成。</p>
<p>​    接下来看看上传的地方：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">handleClick = <span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 绑定了disabled属性</span></div><div class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.disabled) &#123;</div><div class="line">    <span class="keyword">this</span>.$refs.input.click();</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">h(<span class="string">'div'</span>, &#123;</div><div class="line">  class: &#123;</div><div class="line">    <span class="string">'el-upload'</span>: <span class="literal">true</span></div><div class="line">  &#125;,</div><div class="line">  <span class="comment">// 点击事件 </span></div><div class="line">  on: &#123;</div><div class="line">    click: handleClick</div><div class="line">  &#125;</div><div class="line">&#125;, [drag ?</div><div class="line">    <span class="comment">// 拖动</span></div><div class="line">    h(</div><div class="line">      <span class="string">'upload-dragger'</span>, &#123;</div><div class="line">        attrs: &#123;</div><div class="line">          disabled: disabled</div><div class="line">        &#125;,</div><div class="line">        on: &#123;</div><div class="line">          <span class="string">'file'</span>: uploadFiles</div><div class="line">        &#125;</div><div class="line">      &#125;, [<span class="keyword">this</span>.$slots.default]</div><div class="line">    ) :</div><div class="line">    <span class="comment">// 普通情况</span></div><div class="line">    <span class="keyword">this</span>.$slots.default, h(</div><div class="line">      <span class="string">'input'</span>, &#123;</div><div class="line">        <span class="string">'class'</span>: <span class="string">'el-upload__input'</span>,</div><div class="line">        attrs: &#123;</div><div class="line">          type: <span class="string">'file'</span>,</div><div class="line">          name: name,</div><div class="line">          multiple: multiple,</div><div class="line">          accept: accept</div><div class="line">        &#125;,</div><div class="line">        ref: <span class="string">'input'</span>,</div><div class="line">        on: &#123;</div><div class="line">          <span class="string">'change'</span>: handleChange</div><div class="line">        &#125;</div><div class="line">      &#125;, []</div><div class="line">    )</div><div class="line">   ]);</div></pre></td></tr></table></figure>
<p>​    可以看到，这里的上传点击事件同样绑定了disabled属性，也就是说，如果把上传禁用了，那么删除的功能也会被禁用。</p>
<p>​    那么问题来了，项目里为啥不会出现问题？？？调试有点繁琐，最近忙的要死，有空再看。</p>
<p>​    <strong>万万没想到，我最后还是找到了原因。</strong></p>
<p>​    项目里我用了webpack的vendor中将公共框架打包，其中也包含了element-ui，在其中搜索el-upload-list__item-delete字段，我发现了问题的所在：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  (_vm.handlePreview &amp;&amp; _vm.listType === <span class="string">'picture-card'</span>) ?</div><div class="line">  _c(<span class="string">'span'</span>, &#123;</div><div class="line">    staticClass: <span class="string">"el-upload-list__item-preview"</span>,</div><div class="line">    on: &#123;</div><div class="line">      <span class="string">"click"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">$event</span>) </span>&#123;</div><div class="line">        _vm.handlePreview(file)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;, [_c(<span class="string">'i'</span>, &#123;</div><div class="line">    staticClass: <span class="string">"el-icon-view"</span></div><div class="line">  &#125;)]) :</div><div class="line">  _vm._e(),</div><div class="line">  <span class="comment">// (!_vm.disabled)这里没有！！！！</span></div><div class="line">  _c(<span class="string">'span'</span>, &#123;</div><div class="line">    staticClass: <span class="string">"el-upload-list__item-delete"</span>,</div><div class="line">    on: &#123;</div><div class="line">      <span class="string">"click"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">$event</span>) </span>&#123;</div><div class="line">        _vm.$emit(<span class="string">'remove'</span>, file)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;, [_c(<span class="string">'i'</span>, &#123;</div><div class="line">    staticClass: <span class="string">"el-icon-delete2"</span></div><div class="line">  &#125;)])</div><div class="line">]</div></pre></td></tr></table></figure>
<p>​    发现了没有？？？我靠，我不知道我打包的是不是假的element-ui，我只明白一点，要是正版里面有那一条判断语句，我不删掉的话，我的项目就拜拜了。</p>
<p>​    <strong>后来的后来，我终于找到了原因</strong></p>
<p>​    先贴个链接：<a href="https://github.com/ElemeFE/element/commit/c8442ac3c96d554caf92c5103083b23351f4ebf8" target="_blank" rel="external">https://github.com/ElemeFE/element/commit/c8442ac3c96d554caf92c5103083b23351f4ebf8</a></p>
<p>​    我的项目版本是1.3.7，目前最新的是1.4.7，在某一次commit中，添加了这一条判断，为啥啊！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://c.hiphotos.baidu.com/zhidao/pic/item/b03533fa828ba61e9a43845d4734970a304e5916.jpg/2017/10/18/bug-note/" data-id="cj959bq4p0000c8njyg7rpzj3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-post" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/12/post/" class="article-date">
  <time datetime="2017-10-12T02:15:16.000Z" itemprop="datePublished">2017-10-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/12/post/">Java中Math.random()源码浅析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<blockquote>
<p>好久没写博客，忙的有点晕。</p>
<p>开始从零自学java消遣一下，看书有点脑阔疼，不如看看源码！(๑╹◡╹)ﾉ”””</p>
</blockquote>
<p>​    JS中Math调用的都是本地方法，底层全是用C++写的，所以完全无法观察实现过程，Java的工具包虽然也有C/C++的介入，不过也有些是自己实现的。</p>
<p>​    本篇文章主要简单阐述Math.random()的实现过程。</p>
<p>​    Math隶属于java.lang包中，默认加载。本身是一个final类，方法都是静态方法，所以使用的时候不需要生成一个实例，直接调用Math.XX就行了。</p>
<p>​    一步一步观察该方法，首先是java.lang.Math：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Math</span> </span>&#123;</div><div class="line">  <span class="comment">// 大量静态变量与方法</span></div><div class="line">  <span class="comment">// ...</span></div><div class="line">  </div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Random randomNumberGenerator;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">initRNG</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (randomNumberGenerator == <span class="keyword">null</span>) </div><div class="line">      randomNumberGenerator = <span class="keyword">new</span> Random();</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">random</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (randomNumberGenerator == <span class="keyword">null</span>) initRNG();</div><div class="line">    <span class="keyword">return</span> randomNumberGenerator.nextDouble();</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="comment">// ...other</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    这里面与random相关的操作有3个：</p>
<p>1、声明一个私有静态Random类randomNumberGenerator</p>
<p>2、若randomNumberGenerator未初始化，调用new Random()将其初始化</p>
<p>3、若randomNumberGenerator已经初始化，调用nextDouble方法并将其值返回</p>
<p><strong>tips</strong>：synchronized关键字代表同步执行此方法，Java为多线程，所以为了保证randomNumberGenerator对象只被初始化一次，需要该关键字。比如两个线程同时调用了Math.random()，线程A发现rXX未被初始化，进入initRNG调用new Random()方法。此时线程B也发现了rXX未被初始化，但是initRNG是同步方法，所以挂起等待线程A执行完毕。当线程A执行完后把rXX初始化了，所以在initRNG中的if判断，线程B会直接返回。</p>
<p>​    所以简单来讲，random方法会在第一次调用时生成一个randomNumberGenerator对象，并调用其nextDouble方法生成随机数，之后的调用就只要持续调用此方法返回随机数就行了。</p>
<p>​    下面来看Random类是个什么鬼，来源于java.util.Random：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Random</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</div><div class="line">  <span class="comment">// 静态变量</span></div><div class="line">  <span class="comment">/** use serialVersionUID from JDK 1.1 for interoperability */</span></div><div class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3905348978240129619L</span>;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> AtomicLong seed;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> multiplier = <span class="number">0x5DEECE66DL</span>;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> addend = <span class="number">0xBL</span>;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> mask = (<span class="number">1L</span> &lt;&lt; <span class="number">48</span>) - <span class="number">1</span>;</div><div class="line"></div><div class="line">  <span class="comment">// constructor</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Random</span><span class="params">()</span> </span>&#123; <span class="keyword">this</span>(++seedUniquifier + System.nanoTime()); &#125;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">long</span> seedUniquifier = <span class="number">8682522807148012L</span>;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Random</span><span class="params">(<span class="keyword">long</span> seed)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.seed = <span class="keyword">new</span> AtomicLong(<span class="number">0L</span>);</div><div class="line">    setSeed(seed);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 设置种子</span></div><div class="line">  <span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSeed</span><span class="params">(<span class="keyword">long</span> seed)</span> </span>&#123;</div><div class="line">    seed = (seed ^ multiplier) &amp; mask;</div><div class="line">    <span class="keyword">this</span>.seed.set(seed);</div><div class="line">    haveNextNextGaussian = <span class="keyword">false</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 产生大数字</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">next</span><span class="params">(<span class="keyword">int</span> bits)</span> </span>&#123;</div><div class="line">    <span class="keyword">long</span> oldseed, nextseed;</div><div class="line">    AtomicLong seed = <span class="keyword">this</span>.seed;</div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">      oldseed = seed.get();</div><div class="line">      nextseed = (oldseed * multiplier + addend) &amp; mask;</div><div class="line">    &#125; <span class="keyword">while</span> (!seed.compareAndSet(oldseed, nextseed));</div><div class="line">    <span class="keyword">return</span> (<span class="keyword">int</span>)(nextseed &gt;&gt;&gt; (<span class="number">48</span> - bits));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 生成随机数</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">nextDouble</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (((<span class="keyword">long</span>)(next(<span class="number">26</span>)) &lt;&lt; <span class="number">27</span>) + next(<span class="number">27</span>))</div><div class="line">      / (<span class="keyword">double</span>)(<span class="number">1L</span> &lt;&lt; <span class="number">53</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 其他不关心的方法</span></div><div class="line">  <span class="comment">// nextBytes(bytes [])</span></div><div class="line"></div><div class="line">  <span class="comment">// nextInt</span></div><div class="line"></div><div class="line">  <span class="comment">// nextInt(int)</span></div><div class="line"></div><div class="line">  <span class="comment">// nextLong</span></div><div class="line"></div><div class="line">  <span class="comment">// nextBoolean</span></div><div class="line"></div><div class="line">  <span class="comment">// nextFloat</span></div><div class="line"></div><div class="line">  <span class="comment">// Serializable相关</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    上述代码剔除了大量的注释，还有一些不需要关心的方法，本文只关注Math.random()调用相关方法。</p>
<p>​    对于这个类，首先来看看它的构造函数，理论上new一个Random实例是需要一个long类型的整数作为参数，但是代码用了this使其默认调用new Random(long)这个构造函数。而在构造函数中又生成了一个新类并赋值给实例变量seed，关于这个AtomicLong类其实没啥好讲的，简单看一下就行：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicLong</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1927816293512124184L</span>;</div><div class="line"></div><div class="line">  <span class="comment">// valueOffset相关...</span></div><div class="line"></div><div class="line">  <span class="comment">// 实例变量</span></div><div class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">long</span> value;</div><div class="line">  <span class="comment">// 构造函数</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AtomicLong</span><span class="params">(<span class="keyword">long</span> initialValue)</span> </span>&#123;</div><div class="line">    value = initialValue;</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AtomicLong</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">  <span class="comment">// 方法</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> value;</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">long</span> newValue)</span> </span>&#123;</div><div class="line">    value = newValue;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 这个也会用到 但是不用关心具体实现</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">long</span> expect, <span class="keyword">long</span> update)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> unsafe.compareAndSwapLong(<span class="keyword">this</span>, valueOffset, expect, update);</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 其余不需要关心（其实我也看不懂）的方法</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    如果思想简单一点，可以看出这个类也很简单，初始化传参赋值，set设置，get获取，多简单！</p>
<p>​    现在回到Random类的构造函数中，实例变量被赋值，类的value为初始化的0(后缀L代表这是一个long类型整数)。下一步调用setSeed，传入构造函数的long类型seed变量(不是seed类)，其值为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">++seedUniquifier + System.nanoTime()</div><div class="line"><span class="comment">// private static volatile long seedUniquifier = 8682522807148012L(8.6825e+15);</span></div><div class="line"><span class="comment">// 2^52 ~ 2^53</span></div><div class="line"><span class="comment">// 写文章时测试 =&gt; System.nanoTime() =&gt; 13230650355964(1.323e+13);</span></div></pre></td></tr></table></figure>
<p>​    其中第一个变量为一个固定值，每次加1，另外一个为System.nanoTime()，该方法返回一个与当前时间相关的数字，具体我不关心。</p>
<p>​    两个相加后，作为初始种子出传入setSeed方法中，方法第一步会对seed进行二次计算：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">seed = (seed ^ multiplier) &amp; mask;</div><div class="line"><span class="comment">// private final static long multiplier = 0x5DEECE66DL;(25214903917 =&gt; 2.5214e+10)</span></div><div class="line"><span class="comment">// 2^34 ~ 2^35</span></div><div class="line"><span class="comment">// private final static long mask = (1L &lt;&lt; 48) - 1;(2^48-1 =&gt; 0111...1 =&gt; 2^48 = 2.8147+e14)</span></div></pre></td></tr></table></figure>
<p>​    此处进行的是位运算，这里不用关心具体数值，只关注可能得到的最大最小值。</p>
<p>​    ^ =&gt; 异或运算：3 ^ 4 =&gt; 011 ^ 100 = 111 =&gt; 7(不一样置1，否则置0)</p>
<p>​    可以看出，两个数字异或运算，假设其中较大的二进制位数为n，结果一定是小于等于2^n-1，比如3^4，4为100三位，所以结果一定小于等于2^3-1，即7。</p>
<p>​    &amp; =&gt; 与运算：3 &amp; 4 =&gt; 011 &amp; 100 = 000 =&gt; 0(都为1置1，否则置0)</p>
<p>​    可以看出，与运算的结果总是小于等于较小的那个数。</p>
<p>​    </p>
<p>​    这样来再来看之前的位运算：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">seed(<span class="number">2</span>^<span class="number">52</span> ~ <span class="number">2</span>^<span class="number">53</span>) ^ multiplier(<span class="number">2</span>^<span class="number">34</span> ~ <span class="number">2</span>^<span class="number">35</span>) =&gt; <span class="number">0</span> ~ (<span class="number">2</span>^<span class="number">53</span>-<span class="number">1</span>)</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(seed ^ multiplier)(<span class="number">0</span> ~ <span class="number">2</span>^<span class="number">53</span>-<span class="number">1</span>) &amp; mask(<span class="number">2</span>^<span class="number">48</span>-<span class="number">1</span>) =&gt; <span class="number">0</span> ~ <span class="number">2</span>^<span class="number">48</span>-<span class="number">1</span></div></pre></td></tr></table></figure>
<p>​    结论是种子的范围是在0 ~ 2^48-1之间。</p>
<p>​    测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</div><div class="line">    pro b = <span class="keyword">new</span> pro();</div><div class="line">    System.out.println(b.getValue());</div><div class="line">    <span class="comment">// 256403749474577</span></div><div class="line">    <span class="comment">// 256458702577093</span></div><div class="line">    <span class="comment">// 256431328421593</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">pro</span></span>&#123;</div><div class="line">  <span class="keyword">long</span> seed = <span class="number">8682522807148012L</span> + System.nanoTime();</div><div class="line">  <span class="keyword">long</span> multiplier = <span class="number">0x5DEECE66DL</span>;</div><div class="line">  <span class="keyword">long</span> mask = (<span class="number">1L</span> &lt;&lt; <span class="number">48</span>) - <span class="number">1</span>;</div><div class="line">  <span class="function"><span class="keyword">long</span> <span class="title">getValue</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> (seed ^ multiplier) &amp; mask;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    构造函数调用完后，现在来看nextDouble，这个方法除去位运算，本质上就是调用了两次next方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">nextDouble</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> (((<span class="keyword">long</span>)(next(<span class="number">26</span>)) &lt;&lt; <span class="number">27</span>) + next(<span class="number">27</span>))</div><div class="line">    / (<span class="keyword">double</span>)(<span class="number">1L</span> &lt;&lt; <span class="number">53</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    所以直接看next方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">next</span><span class="params">(<span class="keyword">int</span> bits)</span> </span>&#123;</div><div class="line">  <span class="keyword">long</span> oldseed, nextseed;</div><div class="line">  AtomicLong seed = <span class="keyword">this</span>.seed;</div><div class="line">  <span class="keyword">do</span> &#123;</div><div class="line">    oldseed = seed.get();</div><div class="line">    nextseed = (oldseed * multiplier + addend) &amp; mask;</div><div class="line">  &#125; <span class="keyword">while</span> (!seed.compareAndSet(oldseed, nextseed));</div><div class="line">  <span class="keyword">return</span> (<span class="keyword">int</span>)(nextseed &gt;&gt;&gt; (<span class="number">48</span> - bits));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    方法内部声明了2个long类型种子：oldseed、nextseed，通过get方法取得之前位运算得到的seed赋值给oldseed，然后再次通过运算得到一个nextseed的值，并传给seed.compareAndSet(oldseed, nextseed)方法中。</p>
<p>​    关于这个方法，源码里是这样的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// java.util.concurrent.atomic.AtomicLong;</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicLong</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">long</span> expect, <span class="keyword">long</span> update)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> unsafe.compareAndSwapLong(<span class="keyword">this</span>, valueOffset, expect, update);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// sun.misc.Unsafe.java</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">compareAndSwapLong</span><span class="params">(Object obj, <span class="keyword">long</span> offset,<span class="keyword">long</span> expect, <span class="keyword">long</span> update)</span></span>;</div></pre></td></tr></table></figure>
<p>​    这个方法是个内部方法，也就是用C/C++实现的，所以有兴趣的自己去看源码，这里贴一个blog：</p>
<p>​    <a href="http://www.cnblogs.com/Mainz/p/3546347.html" target="_blank" rel="external">http://www.cnblogs.com/Mainz/p/3546347.html</a></p>
<p>​    方法的用处简单讲也很简单，比较oldseed与内存中预期的值，如果符合，就将nextseed放进去。</p>
<p>​    </p>
<p>​    这里的运算也不管具体数值，oldseed * multiplier按最大计算会出现溢位，截取成long类型后的大小不确定，所以按照与运算这里的范围依然是0 ~ mask，即0 ~ 2^48-1。</p>
<p>​    最后返回(int)(nextseed &gt;&gt;&gt; (48 - bits))，这里对结果进行类型处理，贴一个类型范围图：</p>
<table>
<thead>
<tr>
<th style="text-align:center">基本类型</th>
<th style="text-align:center">最小值</th>
<th style="text-align:center">最大值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">byte</td>
<td style="text-align:center">-2^7</td>
<td style="text-align:center">2^7 - 1</td>
</tr>
<tr>
<td style="text-align:center">short</td>
<td style="text-align:center">-2^15</td>
<td style="text-align:center">2^15 - 1</td>
</tr>
<tr>
<td style="text-align:center">int</td>
<td style="text-align:center">-2^31</td>
<td style="text-align:center">2^31 - 1</td>
</tr>
<tr>
<td style="text-align:center">long</td>
<td style="text-align:center">-2^63</td>
<td style="text-align:center">2^63 - 1</td>
</tr>
</tbody>
</table>
<p>​    若结果是大于int类型最大值，超出的部分会被直接截取砍掉。</p>
<p>​    最后看nextDouble的计算式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(((<span class="keyword">long</span>)(next(<span class="number">26</span>)) &lt;&lt; <span class="number">27</span>) + next(<span class="number">27</span>)) / (<span class="keyword">double</span>)(<span class="number">1L</span> &lt;&lt; <span class="number">53</span>)</div></pre></td></tr></table></figure>
<p>​    传入的bits分别为26与27，这时返回的随机数为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(<span class="keyword">int</span>)(nextseed &gt;&gt;&gt; <span class="number">22</span>) 与 (<span class="keyword">int</span>)(nextseed &gt;&gt;&gt; <span class="number">21</span>)</div></pre></td></tr></table></figure>
<p>​    >>>为无符号右移，具体意思就不解释了。</p>
<p>​    得到的结果范围大概是 0 ~ 2^26(27)-1，理论上在这里是不会超过int的最大值。</p>
<p>​    当seed(测试代码中的tmp)为mask时，此时计算会达到最大值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(((<span class="keyword">long</span>)(<span class="number">1L</span> &lt;&lt; <span class="number">53</span>)-<span class="number">1</span> ) / (<span class="keyword">double</span>)(<span class="number">1L</span> &lt;&lt; <span class="number">53</span>)</div></pre></td></tr></table></figure>
<p>​    测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</div><div class="line">    testb bb = <span class="keyword">new</span> testb();</div><div class="line">    <span class="keyword">long</span> a = (<span class="keyword">long</span>)bb.getNext(<span class="number">26</span>);</div><div class="line">    <span class="keyword">long</span> b = bb.getNext(<span class="number">27</span>);</div><div class="line">    <span class="keyword">double</span> c = <span class="number">1L</span> &lt;&lt; <span class="number">53</span>;</div><div class="line">    <span class="keyword">double</span> d = ((a&lt;&lt;<span class="number">27</span>) +b)/c;</div><div class="line">    <span class="comment">// 0.99999999...</span></div><div class="line">    System.out.println(d);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">testb</span></span>&#123;</div><div class="line">  <span class="keyword">long</span> tmp = (<span class="number">1L</span>&lt;&lt;<span class="number">48</span>)-<span class="number">1</span>;</div><div class="line">  <span class="comment">// long tmp = 0 =&gt; 0.0</span></div><div class="line">  <span class="function"><span class="keyword">int</span> <span class="title">getNext</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> (<span class="keyword">int</span>)(tmp &gt;&gt;&gt; (<span class="number">48</span> - num));</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    当测试代码中tmp为0时，计算结果为最小值0。</p>
<p>​    每一次调用nextDouble，会生成不一样的seed，也就会返回不一样的数字。</p>
<p>​    这样就是整个随机数生成过程。</p>
<p>​    完结，撒花ヽ(ﾟ∀ﾟ)ﾒ(ﾟ∀ﾟ)ﾉ </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://c.hiphotos.baidu.com/zhidao/pic/item/b03533fa828ba61e9a43845d4734970a304e5916.jpg/2017/10/12/post/" data-id="cj959bq4z0003c8njh599nktr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/12/hello-world/" class="article-date">
  <time datetime="2017-10-12T01:56:24.879Z" itemprop="datePublished">2017-10-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/12/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://c.hiphotos.baidu.com/zhidao/pic/item/b03533fa828ba61e9a43845d4734970a304e5916.jpg/2017/10/12/hello-world/" data-id="cj959bq4u0001c8nj210lrock" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/10/23/upload2/">element-ui源码修改笔记2</a>
          </li>
        
          <li>
            <a href="/2017/10/23/upload/">element-ui源码修改笔记</a>
          </li>
        
          <li>
            <a href="/2017/10/18/bug-note/">element-ui组件问题</a>
          </li>
        
          <li>
            <a href="/2017/10/12/post/">Java中Math.random()源码浅析</a>
          </li>
        
          <li>
            <a href="/2017/10/12/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>